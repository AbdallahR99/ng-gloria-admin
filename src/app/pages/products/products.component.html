<div class="container mx-auto p-6">
  <!-- Header -->
  <div
    class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6"
  >
    <div>
      <h1 class="text-3xl font-bold">Products Management</h1>
      <p class="text-base-content/70 mt-1">Manage your product catalog</p>
    </div>
    <div class="flex gap-2">
      <button
        class="btn btn-outline btn-sm"
        (click)="onToggleDeleted()"
        [class.btn-active]="showDeleted()"
      >
        @if (showDeleted()) { Show Active } @else { Show Deleted }
      </button>
      <button class="btn btn-primary" (click)="onCreateProduct()">
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 4v16m8-8H4"
          />
        </svg>
        Add Product
      </button>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="card bg-base-100 shadow-sm mb-6">
    <div class="card-body">
      <form [formGroup]="searchForm" (ngSubmit)="onSearch()" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <!-- Search Input -->
          <div class="form-control">
            <label class="label">
              <span class="label-text">Search Products</span>
            </label>
            <input
              type="text"
              placeholder="Search by name, SKU, or description..."
              class="input input-bordered"
              formControlName="search"
            />
          </div>

          <!-- Category Filter -->
          <div class="form-control">
            <label class="label">
              <span class="label-text">Category</span>
            </label>
            <select class="select select-bordered" formControlName="categoryId">
              <option value="">All Categories</option>
              @for (category of categories(); track category.id) {
              <option [value]="category.id">{{ category.nameEn }}</option>
              }
            </select>
          </div>

          <!-- Min Price -->
          <div class="form-control">
            <label class="label">
              <span class="label-text">Min Price ($)</span>
            </label>
            <input
              type="number"
              placeholder="0.00"
              class="input input-bordered"
              formControlName="minPrice"
              min="0"
              step="0.01"
            />
          </div>

          <!-- Max Price -->
          <div class="form-control">
            <label class="label">
              <span class="label-text">Max Price ($)</span>
            </label>
            <input
              type="number"
              placeholder="999.99"
              class="input input-bordered"
              formControlName="maxPrice"
              min="0"
              step="0.01"
            />
          </div>
        </div>

        <div class="flex gap-2">
          <button type="submit" class="btn btn-primary">
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              />
            </svg>
            Search
          </button>
          <button type="button" class="btn btn-ghost" (click)="onClearSearch()">
            Clear
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Bulk Actions -->
  @if (hasSelection()) {
  <div class="alert alert-info mb-4">
    <div class="flex-1">
      <span>{{ selectedProducts().length }} product(s) selected</span>
    </div>
    <div class="flex gap-2">
      <button
        class="btn btn-error btn-sm"
        (click)="onBulkDelete()"
        [class.loading]="isDeleting()"
      >
        @if (isDeleting()) {
        <span class="loading loading-spinner loading-xs"></span>
        } @else {
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
          />
        </svg>
        } Delete Selected
      </button>
    </div>
  </div>
  }

  <!-- Products Table -->
  <div class="card bg-base-100 shadow-sm">
    <div class="card-body p-0">
      <!-- Loading State -->
      @if (isLoading()) {
      <div class="flex justify-center items-center p-12">
        <span class="loading loading-spinner loading-lg"></span>
      </div>
      }

      <!-- Error State -->
      @else if (error()) {
      <div class="alert alert-error m-6">
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        <span>Error loading products: {{ error()?.message }}</span>
      </div>
      }

      <!-- Empty State -->
      @else if (!hasProducts()) {
      <div class="text-center p-12">
        <svg
          class="w-16 h-16 mx-auto text-base-content/30 mb-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
          />
        </svg>
        <h3 class="text-lg font-semibold mb-2">No Products Found</h3>
        <p class="text-base-content/70 mb-4">
          @if (searchQuery() || selectedCategoryId() || minPrice() ||
          maxPrice()) { Try adjusting your search criteria or filters. } @else {
          Start by creating your first product. }
        </p>
        @if (!searchQuery() && !selectedCategoryId() && !minPrice() &&
        !maxPrice()) {
        <button class="btn btn-primary" (click)="onCreateProduct()">
          Create First Product
        </button>
        }
      </div>
      }

      <!-- Products Table -->
      @else {
      <div class="overflow-x-auto">
        <table class="table table-zebra">
          <thead>
            <tr>
              <th>
                <input
                  type="checkbox"
                  class="checkbox"
                  [checked]="allSelected()"
                  (change)="onSelectAll()"
                />
              </th>
              <th>Product</th>
              <th
                class="cursor-pointer hover:bg-base-200"
                (click)="onSort('nameEn')"
              >
                <div class="flex items-center gap-1">
                  Name @if (sortBy() === 'nameEn') {
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    @if (sortOrder() === 'asc') {
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 11l5-5m0 0l5 5m-5-5v12"
                    />
                    } @else {
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17 13l-5 5m0 0l-5-5m5 5V6"
                    />
                    }
                  </svg>
                  }
                </div>
              </th>
              <th>Category</th>
              <th
                class="cursor-pointer hover:bg-base-200"
                (click)="onSort('price')"
              >
                <div class="flex items-center gap-1">
                  Price @if (sortBy() === 'price') {
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    @if (sortOrder() === 'asc') {
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 11l5-5m0 0l5 5m-5-5v12"
                    />
                    } @else {
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17 13l-5 5m0 0l-5-5m5 5V6"
                    />
                    }
                  </svg>
                  }
                </div>
              </th>
              <th
                class="cursor-pointer hover:bg-base-200"
                (click)="onSort('quantity')"
              >
                <div class="flex items-center gap-1">
                  Stock @if (sortBy() === 'quantity') {
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    @if (sortOrder() === 'asc') {
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 11l5-5m0 0l5 5m-5-5v12"
                    />
                    } @else {
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17 13l-5 5m0 0l-5-5m5 5V6"
                    />
                    }
                  </svg>
                  }
                </div>
              </th>
              <th>Rating</th>
              <th
                class="cursor-pointer hover:bg-base-200"
                (click)="onSort('createdAt')"
              >
                <div class="flex items-center gap-1">
                  Created @if (sortBy() === 'createdAt') {
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    @if (sortOrder() === 'asc') {
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 11l5-5m0 0l5 5m-5-5v12"
                    />
                    } @else {
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M17 13l-5 5m0 0l-5-5m5 5V6"
                    />
                    }
                  </svg>
                  }
                </div>
              </th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (product of products(); track product.id) {
            <tr [class.opacity-50]="product.isDeleted">
              <td>
                <input
                  type="checkbox"
                  class="checkbox"
                  [checked]="selectedProducts().includes(product.id)"
                  (change)="onSelectProduct(product.id)"
                />
              </td>
              <td>
                <div class="flex items-center gap-3">
                  <div class="avatar">
                    <div class="w-12 h-12 rounded">
                      @if (product.thumbnail) {
                      <img
                        [src]="product.thumbnail"
                        [alt]="product.nameEn"
                        class="object-cover"
                      />
                      } @else {
                      <div
                        class="w-full h-full bg-base-200 flex items-center justify-center"
                      >
                        <svg
                          class="w-6 h-6 text-base-content/50"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                          />
                        </svg>
                      </div>
                      }
                    </div>
                  </div>
                  <div>
                    <div class="font-medium">{{ product.nameEn }}</div>
                    @if (product.sku) {
                    <div class="text-sm text-base-content/70">
                      SKU: {{ product.sku }}
                    </div>
                    }
                  </div>
                </div>
              </td>
              <td>
                <div>
                  <div class="font-medium">{{ product.nameEn }}</div>
                  <div class="text-sm text-base-content/70">
                    {{ product.nameAr }}
                  </div>
                </div>
              </td>
              <td>
                <span class="badge badge-neutral">{{
                  getCategoryName(product.categoryId)
                }}</span>
              </td>
              <td>
                <div class="flex items-center gap-2">
                  <span class="font-semibold">{{
                    formatPrice(product.price)
                  }}</span>
                  @if (product.oldPrice && product.oldPrice > product.price) {
                  <span class="text-sm text-base-content/50 line-through">{{
                    formatPrice(product.oldPrice)
                  }}</span>
                  <span class="badge badge-success badge-sm"
                    >-{{
                      getDiscountPercentage(product.price, product.oldPrice)
                    }}%</span
                  >
                  }
                </div>
              </td>
              <td>
                <div class="flex items-center gap-2">
                  <span
                    [class]="
                      product.quantity > 10
                        ? 'text-success'
                        : product.quantity > 0
                        ? 'text-warning'
                        : 'text-error'
                    "
                  >
                    {{ product.quantity }}
                  </span>
                  @if (product.quantity === 0) {
                  <span class="badge badge-error badge-xs">Out of Stock</span>
                  } @else if (product.quantity <= 10) {
                  <span class="badge badge-warning badge-xs">Low Stock</span>
                  }
                </div>
              </td>
              <td>
                <div class="flex items-center gap-1">
                  <div class="rating rating-sm">
                    @for (star of [1,2,3,4,5]; track star) {
                    <input
                      type="radio"
                      class="mask mask-star-2"
                      [class.bg-orange-400]="star <= product.stars"
                      [class.bg-base-300]="star > product.stars"
                      disabled
                    />
                    }
                  </div>
                  <span class="text-sm text-base-content/70"
                    >({{ product.reviews }})</span
                  >
                </div>
              </td>
              <td>
                @if (product.createdAt) {
                <div class="text-sm">
                  {{ new Date(product.createdAt).toLocaleDateString() }}
                </div>
                }
              </td>
              <td>
                <div class="flex gap-1">
                  <button
                    class="btn btn-ghost btn-xs"
                    (click)="onViewProduct(product)"
                    title="View Details"
                  >
                    <svg
                      class="w-4 h-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                      />
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                      />
                    </svg>
                  </button>
                  <button
                    class="btn btn-ghost btn-xs"
                    (click)="onEditProduct(product)"
                    title="Edit Product"
                  >
                    <svg
                      class="w-4 h-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                      />
                    </svg>
                  </button>
                  @if (!product.isDeleted) {
                  <button
                    class="btn btn-ghost btn-xs text-error"
                    (click)="onDeleteProduct(product)"
                    title="Delete Product"
                  >
                    <svg
                      class="w-4 h-4"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                      />
                    </svg>
                  </button>
                  }
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      @if (totalPages() > 1) {
      <div class="flex justify-between items-center p-4 border-t">
        <div class="text-sm text-base-content/70">
          Showing {{ (currentPage() - 1) * pageSize() + 1 }} to
          {{ Math.min(currentPage() * pageSize(), totalItems()) }} of
          {{ totalItems() }} products
        </div>

        <div class="flex items-center gap-2">
          <!-- Page Size Selector -->
          <select
            class="select select-bordered select-sm"
            [value]="pageSize()"
            (change)="onPageSizeChange(+($event.target as HTMLSelectElement).value)"
          >
            <option value="10">10 per page</option>
            <option value="25">25 per page</option>
            <option value="50">50 per page</option>
            <option value="100">100 per page</option>
          </select>

          <!-- Pagination Controls -->
          <div class="join">
            <button
              class="join-item btn btn-sm"
              [disabled]="currentPage() === 1"
              (click)="onPageChange(currentPage() - 1)"
            >
              «
            </button>

            @for (page of Array(totalPages()).fill(0).map((_, i) => i + 1);
            track page) { @if (page === 1 || page === totalPages() || (page >=
            currentPage() - 2 && page <= currentPage() + 2)) {
            <button
              class="join-item btn btn-sm"
              [class.btn-active]="page === currentPage()"
              (click)="onPageChange(page)"
            >
              {{ page }}
            </button>
            } @else if (page === currentPage() - 3 || page === currentPage() +
            3) {
            <button class="join-item btn btn-sm btn-disabled">...</button>
            } }

            <button
              class="join-item btn btn-sm"
              [disabled]="currentPage() === totalPages()"
              (click)="onPageChange(currentPage() + 1)"
            >
              »
            </button>
          </div>
        </div>
      </div>
      } }
    </div>
  </div>
</div>
,
